name: Add to Project

on:
  issues:
    types: [opened, reopened]
  pull_request:
    types: [opened, reopened]

jobs:
  add-to-project:
    name: Add issue/PR to project board
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    steps:
      - name: Add to project
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: ${{ secrets.ORG_PROJECT_URL }}
          github-token: ${{ secrets.ADD_TO_PROJECT_PAT }}

      - name: Set initial status
        uses: actions/github-script@v7
        env:
          PROJECT_URL: ${{ secrets.ORG_PROJECT_URL }}
        with:
          github-token: ${{ secrets.ADD_TO_PROJECT_PAT }}
          script: |
            // This is a placeholder for setting the initial "Status" field to "Triage"
            // The add-to-project action will add the item, and project automations
            // should handle setting Status to "Todo" automatically.
            
            const itemType = context.payload.issue ? 'issue' : 'pull_request';
            const itemNumber = context.payload.issue?.number || context.payload.pull_request?.number;
            
            console.log(`Added ${itemType} #${itemNumber} to project`);
            
            // Optional: Add comment to indicate item was added to project
            if (context.payload.action === 'opened') {
              const comment = `ðŸ“‹ This ${itemType} has been added to the organization project board.`;
              
              if (itemType === 'issue') {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: itemNumber,
                  body: comment
                });
              } else {
                await github.rest.pulls.createReview({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  pull_number: itemNumber,
                  body: comment,
                  event: 'COMMENT'
                });
              }
            }
